{
  "meta": {
    "project": "Invoice Adjustment System",
    "date": "2026-01-13",
    "prepared_by": "Generated by TestSprite"
  },
  "product_overview": "The Invoice Adjustment System enables administrators to retrieve invoice information, apply additional discounts to invoice items, and manage refund processes through a user-friendly interface.",
  "core_goals": [
    "Allow administrators to fetch detailed invoice data for review and adjustment preparation.",
    "Enable application of additional discounts on invoice items with clear reasons.",
    "Support multiple refund methods including cash, wallet credit, or balance reduction.",
    "Provide a streamlined frontend interface for efficient invoice adjustment management."
  ],
  "key_features": [
    "API endpoint to retrieve invoice details, items, and current payment status by invoice ID.",
    "API functionality to apply additional discounts on invoice items with proper refund handling.",
    "Frontend interface for administrators to view, modify, and finalize invoice adjustments.",
    "Secure operations with CSRF protection implemented in adjustment API requests."
  ],
  "user_flow_summary": [
    "Administrator logs into the system and navigates to the invoice adjustment page.",
    "Administrator inputs or selects an invoice ID to retrieve invoice details and current payment status.",
    "Administrator selects invoice items to apply additional discounts, specifies the reason, and chooses the refund method.",
    "System processes the discount application and refund according to the selected method.",
    "Administrator receives confirmation of successful adjustment and updated invoice status."
  ],
  "validation_criteria": [
    "Invoice details are accurately retrieved and displayed matching the requested invoice ID.",
    "Additional discount application processes correctly handle refund methods, updating payment balances accordingly.",
    "Frontend interface allows clear input and modification of adjustment parameters without errors.",
    "All API requests for adjustments include valid CSRF tokens to prevent unauthorized operations.",
    "Error handling communicates meaningful messages to users on invalid inputs or processing failures."
  ],
  "code_summary": {
    "tech_stack": [
      "PHP",
      "JavaScript",
      "MySQL",
      "CSS",
      "HTML",
      "XAMPP"
    ],
    "features": [
      {
        "name": "Get Invoice for Adjustment",
        "description": "Retrieves invoice details, items, and current payment status to prepare for adjustment.",
        "files": [
          "api/get_invoice_for_adjustment.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Get Invoice for Adjustment",
            "version": "1.0.0"
          },
          "paths": {
            "/api/get_invoice_for_adjustment.php": {
              "get": {
                "parameters": [
                  {
                    "name": "invoice_id",
                    "in": "query",
                    "required": true,
                    "schema": {
                      "type": "integer"
                    }
                  }
                ],
                "responses": {
                  "200": {
                    "description": "Invoice data",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "success": {
                              "type": "boolean"
                            },
                            "invoice": {
                              "type": "object"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Apply Additional Discount",
        "description": "Applies additional discounts to invoice items and handles refund logic (cash, wallet, or balance reduction).",
        "files": [
          "api/apply_additional_discount.php"
        ],
        "api_doc": {
          "openapi": "3.0.0",
          "info": {
            "title": "Apply Additional Discount",
            "version": "1.0.0"
          },
          "paths": {
            "/api/apply_additional_discount.php": {
              "post": {
                "requestBody": {
                  "content": {
                    "multipart/form-data": {
                      "schema": {
                        "type": "object",
                        "properties": {
                          "invoice_id": {
                            "type": "integer"
                          },
                          "items": {
                            "type": "string"
                          },
                          "reason": {
                            "type": "string"
                          },
                          "refund_method": {
                            "type": "string"
                          },
                          "csrf_token": {
                            "type": "string"
                          }
                        }
                      }
                    }
                  }
                },
                "responses": {
                  "200": {
                    "description": "Adjustment result",
                    "content": {
                      "application/json": {
                        "schema": {
                          "type": "object",
                          "properties": {
                            "success": {
                              "type": "boolean"
                            },
                            "message": {
                              "type": "string"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      {
        "name": "Adjust Invoice UI",
        "description": "Frontend interface for managing invoice adjustments.",
        "files": [
          "admin/adjust_invoice.php"
        ],
        "api_doc": {}
      }
    ]
  }
}
